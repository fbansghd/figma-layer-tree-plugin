<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Inter, sans-serif;
      font-size: 12px;
      padding: 16px;
    }
    h1 {
      font-size: 14px;
      margin-bottom: 16px;
    }
    .section {
      margin-bottom: 12px;
    }
    .label {
      font-size: 11px;
      color: #666;
      margin-bottom: 6px;
    }
    .buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      font-size: 12px;
      cursor: pointer;
    }
    .primary {
      background: #18a0fb;
      color: white;
    }
    .secondary {
      background: #f0f0f0;
    }
    .json-btn {
      background: #333;
      color: white;
    }
    .output-section {
      position: relative;
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .copy-btn {
      padding: 4px 10px;
      font-size: 11px;
    }
    textarea {
      width: 100%;
      height: 350px;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: monospace;
      font-size: 11px;
      resize: vertical;
    }
    .msg {
      margin-top: 8px;
      padding: 8px;
      border-radius: 4px;
    }
    .error { background: #fee; color: #c00; }
    .success { background: #efe; color: #060; }
  </style>
</head>
<body>
  <h1>Layer Tree for AI</h1>
  
  <div class="section">
    <div class="label">Tree</div>
    <div class="buttons">
      <button class="primary" id="export">Selection</button>
      <button class="secondary" id="export-page">Page</button>
    </div>
  </div>
  
  <div class="section">
    <div class="label">JSON (with design details)</div>
    <div class="buttons">
      <button class="json-btn" id="export-json">Export JSON</button>
    </div>
  </div>
  
  <div class="output-section">
    <div class="output-header">
      <div class="label">Output</div>
      <button class="secondary copy-btn" id="copy">Copy</button>
    </div>
    <textarea id="output" readonly placeholder="Select a layer and click Export"></textarea>
  </div>
  
  <div id="msg"></div>

  <script>
    document.getElementById('export').onclick = function() {
      parent.postMessage({ pluginMessage: { type: 'export' } }, '*');
    };
    
    document.getElementById('export-page').onclick = function() {
      parent.postMessage({ pluginMessage: { type: 'export-page' } }, '*');
    };
    
    document.getElementById('export-json').onclick = function() {
      parent.postMessage({ pluginMessage: { type: 'export-json' } }, '*');
    };
    
    document.getElementById('copy').onclick = function() {
      var output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      showMsg('Copied', 'success');
    };
    
    window.onmessage = function(e) {
      var msg = e.data.pluginMessage;
      if (msg.type === 'result') {
        document.getElementById('output').value = msg.data;
      }
      if (msg.type === 'error') {
        showMsg(msg.message, 'error');
      }
    };
    
    function showMsg(text, type) {
      var el = document.getElementById('msg');
      el.className = 'msg ' + type;
      el.textContent = text;
      setTimeout(function() { el.textContent = ''; el.className = ''; }, 2000);
    }
  </script>
</body>
</html>
